<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Esoteric Simulator</title>
    <link rel="icon" href="image/logodiscord.png">
    <link rel="stylesheet" href="css/style.light.css">
    <script src="javascript/index.js" defer></script>
    <script src="https://kit.fontawesome.com/65fd17a1f9.js" crossorigin="anonymous"></script>
</head>
<body onload="customQueenSelectList()">
    <header id="header" class="header">
        <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

            <a href="index.html" class="logo d-flex align-items-center">
              <img src="image/logodiscord.png" alt="">
              <h1>Drag Race Simulator</h1>
            </a>
      
            <i class="mobile-nav-toggle mobile-nav-show bi bi-list"><svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
              </svg></i>
            <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
              </svg></i>
            <nav id="navbar" class="navbar">
              <ul>
                <li><a href="index.html" id="inblock">Home</a></li>
                <li><a href="predef.html" id="inblock">Predefined Casts</a></li>
                <li><a href="custom.html" class="active">Custom</a></li>
                <li><a href="https://forms.gle/yM4fWVpARyArTKKi8" id="inblock" target=_blank>Suggest Songs</a></li>
                <li><a href="https://discord.gg/cKaA8hvcAr" target=_blank>Discord Server</a></li>
              </ul>
            </nav>
      
          </div>
    </header>

    <div class="mainPart" id="MainBlock">
        <div class="content-main">
            <div class="content-left">
                <big>Go here if you want to create a cast with custom queens or create your own rendition of the show's queens!</big>
                <p>
                    <b>Queen name: </b><input type="text" id="queenName" placeholder="Queen name...">
                </p>
                <p>
                    <button onclick="randomizeStats()">Randomize Stats</button>
                </p>
                <small>(Queens' stats must range from 0 to 15)</small>
                <p>
                    <b>Acting Stat: </b> <input type="number"  id="actingStat" class="stats" placeholder="0-15..."> 
                </p>
                <p>
                    <b>Comedy Stat: </b> <input type="number"  id="comedyStat" class="stats" placeholder="0-15...">
                </p>
                <p>
                    <b>Dance Stat: </b> <input type="number"  id="danceStat" class="stats" placeholder="0-15...">
                </p>
                <p>
                    <b>Design Stat: </b> <input type="number"  id="designStat" class="stats" placeholder="0-15...">
                </p>
                <p>
                    <b>Improv Stat: </b> <input type="number"  id="improvStat" class="stats" placeholder="0-15...">
                </p>
                <p>
                    <b>Runway Stat: </b> <input type="number"  id="runwayStat" class="stats" placeholder="0-15...">
                </p>
                <p>
                    <b>Lip Sync Stat: </b> <input type="number"  id="lipsyncStat" class="stats" placeholder="0-15...">
                </p>
                <p>
                    <b>Image URL: </b> <input type="text"  id="url" placeholder="Link of your image...">
                </p>
                <p> Example: <b> www.mysite.com/image.png </b></p>
                <p>
                  <b>Upload Image: </b>
                  <input type="file" id="queenFile" accept="image/*">
                </p>
                <button id="add" onclick="addQueen()">Add queen</button>
                <button id="edit" onclick="updateCustomQueen()" hidden>Update queen</button>
                <p>
                    <b id="announce-new"></b>
                </p>
            </div>

            <div class="content-right">
                <h2>Remove or edit a custom queen</h2>
                <big>Go here to remove or edit one of your already created custom queens.</big>

<!-- Search Bar -->
<div style="margin: 1.5rem 0; text-align:center;">
  <input 
    type="text" 
    id="searchQueenInput" 
    placeholder="Search for a queen..." 
    style="padding: 8px 12px; border-radius: 10px; border: 2px solid #FF6BA9; width: 60%; max-width: 400px; font-size: 1rem; text-align:center;"
    oninput="filterCustomQueens()"
  >
</div>

                <!-- Grid of custom queens -->
                <div id="custom-queens-container" class="drag-cards"></div>

                <!-- Hidden select (for compatibility with index.js) -->
                <select id="custom-remove" style="display:none;"></select>

                <p><b id="announce-remove"></b></p>
            </div>
        </div>
    </div>

    <a href="#" class="toTop">
        <i class="fa-solid fa-angle-up"></i>
    </a>

    <!-- Script to render queens and link to existing logic -->
    <script>
function renderCustomQueensGrid() {
    const container = document.getElementById("custom-queens-container");
    const select = document.getElementById("custom-remove");
    if (!container || !select) return;

    container.innerHTML = "";
    select.innerHTML = "";

    // Load from localStorage directly to ensure we have data even if allCustomQueens isn't yet built
    const stored = localStorage.getItem("customQueens");
    let queens = [];

    if (stored) {
        try {
            queens = JSON.parse(stored);
        } catch (e) {
            console.error("Error parsing custom queens from localStorage:", e);
        }
    }

    // If allCustomQueens exists, prefer that (contains proper Queen instances)
    if (window.allCustomQueens && window.allCustomQueens.length > 0) {
        queens = window.allCustomQueens;
    }

    if (!queens || queens.length === 0) {
        container.innerHTML = "<p>No custom queens yet.</p>";
        return;
    }

    queens.forEach((queen, i) => {
        // Handle both object shapes (raw or Queen instances)
        const name = (typeof queen.getName === "function") ? queen.getName() : queen.name || queen._name || "Unnamed";
        const image = queen.image || queen._image || "image/noimage.png";

        // Keep select in sync for index.js compatibility
        const opt = document.createElement("option");
        opt.text = name;
        opt.value = i;
        select.appendChild(opt);

        // Create card
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <div style="padding:1rem; text-align:center;">
                <img src="${image}" alt="${name}" style="width:160px; height:160px; object-fit:cover; border-radius:30px; border:3px solid black; display:block; margin:0 auto 0.8rem;">
                <div class="header" style="font-weight:bold; margin-bottom:.5rem;">${name}</div>
                <div class="body">
                    <button onclick="selectAndEdit(${i})">Edit Queen</button>
                    <button onclick="selectAndDelete(${i})" class="red">Delete Queen</button>
                </div>
            </div>
        `;
        container.appendChild(card);
    });
}

function selectAndEdit(index) {
    const select = document.getElementById("custom-remove");
    select.selectedIndex = index;
    if (typeof window.editCustomQueen === "function") editCustomQueen();
}

function selectAndDelete(index) {
    const select = document.getElementById("custom-remove");
    select.selectedIndex = index;
    if (typeof window.removeCustomQueen === "function") removeCustomQueen();
}

// Refresh grid once everything (including index.js) is ready
window.addEventListener("load", () => {
    setTimeout(renderCustomQueensGrid, 400);
});

function filterCustomQueens() {
    const input = document.getElementById("searchQueenInput");
    const filter = input.value.toLowerCase();
    const container = document.getElementById("custom-queens-container");
    const cards = container.getElementsByClassName("card");

    for (let i = 0; i < cards.length; i++) {
        const header = cards[i].querySelector(".header");
        if (header) {
            const txtValue = header.textContent || header.innerText;
            if (txtValue.toLowerCase().includes(filter)) {
                cards[i].style.display = "";
            } else {
                cards[i].style.display = "none";
            }
        }
    }
}
</script>
</body>
</html>
